<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.152.0">
    <meta
  name="description"
  content=""
/>
<meta name="author" content="thienlh@thienlu.com" />

    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>Unified multimodal access layer for Quora’s Poe using Amazon Bedrock :: Internship Report</title>

    
    <link href="../../css/nucleus.css?1765232845" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1765232845" rel="stylesheet">
    <link href="../../css/hybrid.css?1765232845" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1765232845" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1765232845" rel="stylesheet">
    <link href="../../css/auto-complete.css?1765232845" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1765232845" rel="stylesheet">
    <link href="../../css/theme.css?1765232845" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1765232845" rel="stylesheet">
    
    <link href="../../css/theme-workshop.css?1765232845" rel="stylesheet">
    
    

    <script src="../../js/jquery-3.3.1.min.js?1765232845"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    

  </head>
  <body class="" data-url="../../3-blogstranslated/3.1-blog1/">
    <nav
  id="sidebar"
  class="showVisitedLinks"
>
   
  <div id="header-wrapper">
    <div id="header"><a id="logo" href="../../">
  <svg
    id="Layer_1"
    data-name="Layer 1"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 60 30"
    width="30%"
  >
    <defs>
      <style>
        .cls-1 {
          fill: #fff;
        }
        .cls-2 {
          fill: #f90;
          fill-rule: evenodd;
        }
      </style>
    </defs>
    <title>AWS-Logo_White-Color</title>
    <path
      class="cls-1"
      d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"
    ></path>
    <path
      class="cls-2"
      d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"
    ></path>
    <path
      class="cls-2"
      d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"
    ></path>
  </svg>
</a>
</div>
     <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1765232845"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1765232845"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1765232845"></script>
 
  </div>

  <div class="highlightable">
    <ul class="topics">
               
<li
  data-nav-id="/1-worklog/"
  title="Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/">
     <b> 1. </b> Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/1-worklog/1.1-week1/"
  title="Week 1 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.1-week1/">
     <b> 1.1. </b> Week 1 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.2-week2/"
  title="Week 2 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.2-week2/">
     <b> 1.2. </b> Week 2 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.3-week3/"
  title="Week 3 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.3-week3/">
     <b> 1.3. </b> Week 3 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.4-week4/"
  title="Week 4 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.4-week4/">
     <b> 1.4. </b> Week 4 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.5-week5/"
  title="Week 5 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.5-week5/">
     <b> 1.5. </b> Week 5 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.6-week6/"
  title="Week 6 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.6-week6/">
     <b> 1.6. </b> Week 6 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.7-week7/"
  title="Week 7 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.7-week7/">
     <b> 1.7. </b> Week 7 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.8-week8/"
  title="Week 8 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.8-week8/">
     <b> 1.8. </b> Week 8 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.9-week9/"
  title="Week 9 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.9-week9/">
     <b> 1.9. </b> Week 9 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.10-week10/"
  title="Week 10 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.10-week10/">
     <b> 1.10. </b> Week 10 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.11-week11/"
  title="Week 11 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.11-week11/">
     <b> 1.11. </b> Week 11 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/1-worklog/1.12-week12/"
  title="Week 12 Worklog"
  class="dd-item 
        
        
        
        "
>
  <a href="../../1-worklog/1.12-week12/">
     <b> 1.12. </b> Week 12 Worklog 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/3-blogstranslated/"
  title="Translated Blogs"
  class="dd-item 
        parent
        
        
        "
>
  <a href="../../3-blogstranslated/">
     <b> 3. </b> Translated Blogs 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/3-blogstranslated/3.1-blog1/"
  title="Unified multimodal access layer for Quora’s Poe using Amazon Bedrock"
  class="dd-item 
        
        active
        
        "
>
  <a href="../../3-blogstranslated/3.1-blog1/">
     <b> 3.1. </b> Unified multimodal access layer for Quora’s Poe using Amazon Bedrock 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/3-blogstranslated/3.2-blog2/"
  title="Streamline access to ISO-rating content changes with Verisk Rating Insights and Amazon Bedrock"
  class="dd-item 
        
        
        
        "
>
  <a href="../../3-blogstranslated/3.2-blog2/">
     <b> 3.2. </b> Streamline access to ISO-rating content changes with Verisk Rating Insights and Amazon Bedrock 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/3-blogstranslated/3.3-blog3/"
  title="How Poland’s Post Bank accelerated digital transformation while maintaining regulatory compliance on AWS"
  class="dd-item 
        
        
        
        "
>
  <a href="../../3-blogstranslated/3.3-blog3/">
     <b> 3.3. </b> How Poland’s Post Bank accelerated digital transformation while maintaining regulatory compliance on AWS 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/5-workshop/"
  title="Workshop"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/">
     <b> 5. </b> Workshop 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/5-workshop/5.1-workshop-overview/"
  title="Introduction"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.1-workshop-overview/">
     <b> 5.1. </b> Introduction 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/5-workshop/5.2-prerequiste/"
  title="Prerequiste"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.2-prerequiste/">
     <b> 5.2. </b> Prerequiste 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/5-workshop/5.3-s3-vpc/"
  title="Access S3 from VPC"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.3-s3-vpc/">
     <b> 5.3. </b> Access S3 from VPC 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/5-workshop/5.3-s3-vpc/5.3.1-create-gwe/"
  title="Create a gateway endpoint"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.3-s3-vpc/5.3.1-create-gwe/">
     <b> 5.3.1 </b> Create a gateway endpoint 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/5-workshop/5.3-s3-vpc/5.3.2-test-gwe/"
  title="Test the Gateway Endpoint"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.3-s3-vpc/5.3.2-test-gwe/">
     <b> 5.3.2 </b> Test the Gateway Endpoint 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
    
            
<li
  data-nav-id="/5-workshop/5.4-s3-onprem/"
  title="Access S3 from on-premises"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.4-s3-onprem/">
     <b> 5.4. </b> Access S3 from on-premises 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/5-workshop/5.4-s3-onprem/5.4.1-prepare/"
  title="Prepare the environment"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.4-s3-onprem/5.4.1-prepare/">
     <b> 5.4.1 </b> Prepare the environment 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/"
  title="Create an S3 Interface endpoint"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.4-s3-onprem/5.4.2-create-interface-enpoint/">
     <b> 5.4.2 </b> Create an S3 Interface endpoint 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/"
  title="Test the Interface Endpoint"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.4-s3-onprem/5.4.3-test-endpoint/">
     <b> 5.4.3 </b> Test the Interface Endpoint 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/"
  title="On-premises DNS Simulation"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.4-s3-onprem/5.4.4-dns-simulation/">
     <b> 5.4.4 </b> On-premises DNS Simulation 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
    
            
<li
  data-nav-id="/5-workshop/5.5-policy/"
  title="VPC Endpoint Policies"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.5-policy/">
     <b> 5.5. </b> VPC Endpoint Policies 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/5-workshop/5.6-cleanup/"
  title="Clean up"
  class="dd-item 
        
        
        
        "
>
  <a href="../../5-workshop/5.6-cleanup/">
     <b> 5.6. </b> Clean up 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/4-eventparticipated/"
  title="Events Participated"
  class="dd-item 
        
        
        
        "
>
  <a href="../../4-eventparticipated/">
     <b> 6. </b> Events Participated 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
  <ul>
          
            
<li
  data-nav-id="/4-eventparticipated/4.1-event1/"
  title="Vietnam Cloud Day 2025"
  class="dd-item 
        
        
        
        "
>
  <a href="../../4-eventparticipated/4.1-event1/">
     <b> 4.1. </b> Vietnam Cloud Day 2025 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/4-eventparticipated/4.2-event2/"
  title="AI-Driven Development Life Cycle"
  class="dd-item 
        
        
        
        "
>
  <a href="../../4-eventparticipated/4.2-event2/">
     <b> 4.2. </b> AI-Driven Development Life Cycle 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/4-eventparticipated/4.3-event3/"
  title="AWS Cloud Mastery Series #1"
  class="dd-item 
        
        
        
        "
>
  <a href="../../4-eventparticipated/4.3-event3/">
     <b> 4.3. </b> AWS Cloud Mastery Series #1 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/4-eventparticipated/4.4-event4/"
  title="AWS Cloud Mastery Series #2"
  class="dd-item 
        
        
        
        "
>
  <a href="../../4-eventparticipated/4.4-event4/">
     <b> 4.4. </b> AWS Cloud Mastery Series #2 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
            
<li
  data-nav-id="/4-eventparticipated/4.5-event5/"
  title="AWS Cloud Mastery Series #3"
  class="dd-item 
        
        
        
        "
>
  <a href="../../4-eventparticipated/4.5-event5/">
     <b> 4.5. </b> AWS Cloud Mastery Series #3 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
     
  </ul>
  
</li>
           
<li
  data-nav-id="/6-self-evaluation/"
  title="Self-Assessment"
  class="dd-item 
        
        
        
        "
>
  <a href="../../6-self-evaluation/">
     <b> 6. </b> Self-Assessment 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
           
<li
  data-nav-id="/7-feedback/"
  title="Sharing and Feedback"
  class="dd-item 
        
        
        
        "
>
  <a href="../../7-feedback/">
     <b> 7. </b> Sharing and Feedback 
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
           
<li
  data-nav-id="/2-proposal/"
  title=""
  class="dd-item 
        
        
        
        "
>
  <a href="../../2-proposal/">
     
    <i class="fas fa-check read-icon"></i>
    
  </a>
   
</li>
    
    </ul>

     
    <section id="shortcuts">
      <h3>
        More
      </h3>
      <ul>
        
        <li>
          <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"
            ><i class='fab fa-facebook'></i> AWS Study Group</a
          >
        </li>
        
      </ul>
    </section>
     
    <section id="prefooter">
      <hr />
      <ul>
        
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
            <div class="select-style">
              <select id="select-language" onchange="location = this.value;">
                       
                <option
                  id="en"
                  value="//localhost:1313/3-blogstranslated/3.1-blog1/"
                  selected
                >
                  English
                </option>
                            
                <option
                  id="vi"
                  value="//localhost:1313/vi/3-blogstranslated/3.1-blog1/"
                >
                  Tiếng Việt
                </option>
                   
              </select>
              <svg
                version="1.1"
                id="Capa_1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                x="0px"
                y="0px"
                width="255px"
                height="255px"
                viewBox="0 0 255 255"
                style="enable-background: new 0 0 255 255"
                xml:space="preserve"
              >
                <g>
                  <g id="arrow-drop-down">
                    <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
                  </g>
                </g>
              </svg>
            </div>
          </a>
        </li>
         
        <li>
          <a class="padding" href="#" data-clear-history-toggle=""
            ><i class="fas fa-history fa-fw"></i> Clear History</a
          >
        </li>
        
      </ul>
    </section>
    
    <section id="footer"><left>
    
    <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0"
        title="Migrate" Alt="web counter" border="0" /></a> <br>
    <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0"
        title="Total CLoud Journey" Alt="web counter" border="0" />

</left>
<left>
    <br>
    <br>
    <b>Last Updated</b><br>
    <i>
        <span id="lastUpdated" style="color:orange;"></span>
    </i>

    <script>
        
        const today = new Date();
        
        const formattedDate = today.toLocaleDateString('en-GB');
        
        document.getElementById('lastUpdated').textContent = formattedDate;
    </script>
</left>
<left>
    <br>
    <br>
    <b> Team </b> <br>

    <i> <a href="https://www.facebook.com/groups/660548818043427" style="color:orange">First Cloud Journey </a> <br>

    </i>
</left>

<script async defer src="https://buttons.github.io/buttons.js"></script></section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>Internship Report</a> > <a href='../../3-blogstranslated/'>Translated Blogs</a> > Unified multimodal access layer for Quora’s Poe using Amazon Bedrock
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
  <div class="wrapper"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#quora-and-amazon-bedrock"><strong>Quora and Amazon Bedrock</strong></a></li>
        <li><a href="#technical-challenge-bridging-different-systems"><strong>Technical challenge: Bridging different systems</strong></a></li>
        <li><a href="#architectural-divide"><strong>Architectural divide</strong></a></li>
        <li><a href="#api-evolution-and-the-converse-api"><strong>API evolution and the Converse API</strong></a></li>
        <li><a href="#solution-overview"><strong>Solution overview</strong></a></li>
        <li><a href="#configuration-template-for-rapid-multi-bot-deployment"><strong>Configuration template for rapid multi-bot deployment</strong></a></li>
        <li><a href="#advanced-multimodal-capabilities"><strong>Advanced multimodal capabilities</strong></a></li>
        <li><a href="#protocol-translation-layer"><strong>Protocol translation layer</strong></a></li>
        <li><a href="#error-handling-and-normalization"><strong>Error handling and normalization</strong></a></li>
        <li><a href="#token-counting-and-optimization"><strong>Token counting and optimization</strong></a></li>
        <li><a href="#aws-authentication-and-security"><strong>AWS authentication and security</strong></a></li>
        <li><a href="#comparative-analysis"><strong>Comparative analysis</strong></a></li>
        <li><a href="#performance-metrics-and-business-impact"><strong>Performance metrics and business impact</strong></a></li>
        <li><a href="#scaling-and-performance-considerations"><strong>Scaling and performance considerations</strong></a></li>
        <li><a href="#security-considerations"><strong>Security considerations</strong></a></li>
        <li><a href="#troubleshooting-and-debugging"><strong>Troubleshooting and debugging</strong></a></li>
        <li><a href="#lessons-learned-and-best-practices"><strong>Lessons learned and best practices</strong></a></li>
        <li><a href="#conclusion"><strong>Conclusion</strong></a></li>
        <li><a href="#to-learn-more-about-implementing-similar-solutions-explore"><strong>To learn more about implementing similar solutions, explore:</strong></a></li>
        <li><a href="#about-the-authors"><strong>About the authors</strong></a></li>
      </ul>
    </li>
  </ul>
</nav></div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Unified multimodal access layer for Quora’s Poe using Amazon Bedrock
            </h1>
          

        



	<p>Authors: Gilbert V. Lepadatu and Nick Huber | Posted: 16/09/2025 | Categories: <a href="https://aws.amazon.com/blogs/machine-learning/category/artificial-intelligence/amazon-machine-learning/amazon-bedrock/">Amazon Bedrock</a>, <a href="https://aws.amazon.com/blogs/machine-learning/category/post-types/customer-solutions/">Customer Solutions</a>, <a href="https://aws.amazon.com/blogs/machine-learning/category/artificial-intelligence/generative-ai/foundation-models/">Foundation models</a>, <a href="https://aws.amazon.com/blogs/machine-learning/category/artificial-intelligence/generative-ai/">Generative AI</a></p>
<p>Organizations gain competitive advantage by deploying and integrating new generative AI models quickly through Generative AI Gateway architectures. This unified interface approach simplifies access to multiple foundation models (FMs), addressing a critical challenge: the proliferation of specialized AI models, each with unique capabilities, API specifications, and operational requirements. Rather than building and maintaining separate integration points for each model, the smart move is to build an abstraction layer that normalizes these differences behind a single, consistent API.</p>
<p>The AWS Generative AI Innovation Center and Quora recently collaborated on an innovative solution to address this challenge. Together, they developed a unified wrapper API framework that streamlines the deployment of Amazon Bedrock FMs on Quora’s Poe system. This architecture delivers a “build once, deploy multiple models” capability that significantly reduces deployment time and engineering effort, with real protocol bridging code visible throughout the codebase.</p>
<p>For technology leaders and developers working on AI multi-model deployment at scale, this framework demonstrates how thoughtful abstraction and protocol translation can accelerate innovation cycles while maintaining operational control.</p>
<p>In this post, we explore how the AWS Generative AI Innovation Center and Quora collaborated to build a unified wrapper API framework that dramatically accelerates the deployment of Amazon Bedrock FMs on Quora’s Poe system. We detail the technical architecture that bridges Poe’s event-driven ServerSentEvents protocol with Amazon Bedrock REST-based APIs, demonstrate how a template-based configuration system reduced deployment time from days to 15 minutes, and share implementation patterns for protocol translation, error handling, and multi-modal capabilities. We show how this “build once, deploy multiple models” approach helped Poe integrate over 30 Amazon Bedrock models across text, image, and video modalities while reducing code changes by up to 95%.</p>
<hr>
<h3 id="quora-and-amazon-bedrock"><strong>Quora and Amazon Bedrock</strong></h3>
<p><a href="http://poe.com/">Poe.com</a> is an AI system developed by Quora that users and developers can use to interact with a wide range of advanced AI models and assistants powered by multiple providers. The system offers multi-model access, enabling side-by-side conversations with various AI chatbots for tasks such as natural language understanding, content generation, image creation, and more.</p>
<p>The screenshot below showcases the user interface (UI) of Poe, the AI platform created by Quora. The image displays Poe’s extensive library of AI models, which are presented as individual “chatbots” that users can interact with.</p>
<p><img src="../../3-blogstranslated/3.1-blog1/1.png" alt=""></p>
<p><em>Figure 1: Poe’s AI model library interface</em></p>
<p>The following screenshot provides a view of the <strong>Model Catalog</strong> within Amazon Bedrock, a fully managed service from Amazon Web Services (AWS) that offers access to a diverse range of foundation models (FMs). This catalog acts as a central hub for developers to discover, evaluate, and access state-of-the-art AI from various providers.</p>
<p><img src="../../3-blogstranslated/3.1-blog1/2.png" alt=""></p>
<p><em>Figure 2: Model Catalog interface in Amazon Bedrock</em></p>
<p>Initially, integrating the diverse FMs available through Amazon Bedrock presented significant technical challenges for the <a href="http://Poe.com">Poe.com</a> team. The process required substantial engineering resources to establish connections with each model while maintaining consistent performance and reliability standards. Maintainability quickly emerged as an extremely important consideration, as did the ability to efficiently onboard new models as they became available—both factors adding further complexity to the integration challenges.</p>
<hr>
<h3 id="technical-challenge-bridging-different-systems"><strong>Technical challenge: Bridging different systems</strong></h3>
<p>The integration between Poe and Amazon Bedrock presented fundamental architectural challenges that required innovative solutions. These systems were built with different design philosophies and communication patterns, creating a significant technical divide that the wrapper API needed to bridge.</p>
<h3 id="architectural-divide"><strong>Architectural divide</strong></h3>
<p>The core challenge stems from the fundamentally different architectural approaches of the two systems. Understanding these differences is essential to appreciating the complexity of the integration solution.</p>
<p>Poe operates on a modern, reactive, ServerSentEvents-based architecture through the FastAPI library (<code>fastapi_poe</code>). This architecture is stream-optimized for real-time interactions and uses an event-driven response model designed for continuous, conversational AI.</p>
<p>Amazon Bedrock, on the other hand, functions as an enterprise cloud service. It offers REST-based APIs with AWS SDK access patterns, SigV4 authentication requirements, AWS Region-specific model availability, and a traditional request–response interaction pattern with streaming options.</p>
<p>This fundamental API mismatch creates several technical challenges that the Poe wrapper API solves, as summarized in the following table.</p>
<h4 id="table-integration-challenges-between-poe-and-amazon-bedrock"><strong>Table: Integration challenges between Poe and Amazon Bedrock</strong></h4>
<table>
  <thead>
      <tr>
          <th>Challenge Category</th>
          <th>Technical Issue</th>
          <th>Source Protocol</th>
          <th>Target Protocol</th>
          <th>Integration Complexity</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Protocol Translation</strong></td>
          <td>Converting between WebSocket-based protocol and REST APIs</td>
          <td>WebSocket (bidirectional, persistent)</td>
          <td>REST (request/response, stateless)</td>
          <td>High – requires protocol bridging</td>
      </tr>
      <tr>
          <td><strong>Authentication Bridging</strong></td>
          <td>Connecting JWT validation with AWS SigV4 signing</td>
          <td>JWT token validation</td>
          <td>AWS SigV4 authentication</td>
          <td>Medium – credential transformation needed</td>
      </tr>
      <tr>
          <td><strong>Response Format Transformation</strong></td>
          <td>Adapting JSON responses into expected format</td>
          <td>Standard JSON structure</td>
          <td>Custom format requirements</td>
          <td>Medium – data structure mapping</td>
      </tr>
      <tr>
          <td><strong>Streaming Reconciliation</strong></td>
          <td>Mapping chunked responses to ServerSentEvents</td>
          <td>Chunked HTTP responses</td>
          <td>ServerSentEvents stream</td>
          <td>High – real-time data flow conversion</td>
      </tr>
      <tr>
          <td><strong>Parameter Standardization</strong></td>
          <td>Creating unified parameter space across models</td>
          <td>Model-specific parameters</td>
          <td>Standardized parameter interface</td>
          <td>Medium – parameter normalization</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="api-evolution-and-the-converse-api"><strong>API evolution and the Converse API</strong></h3>
<p>In May 2024, Amazon Bedrock introduced the <strong>Converse API</strong>, which offered standardization benefits that significantly simplified the integration architecture. Key capabilities include:</p>
<ul>
<li>A unified interface across diverse model providers (such as Anthropic, Meta, and Mistral).</li>
<li>Conversation memory with consistent handling of chat history.</li>
<li>Streaming and non-streaming modes through a single API pattern.</li>
<li>Multimodal support for text, images, and structured data.</li>
<li>Parameter normalization that reduces model-specific implementation quirks.</li>
<li>Built-in content moderation capabilities.</li>
</ul>
<p>The solution presented in this post uses the Converse API where appropriate, while also maintaining compatibility with model-specific APIs for specialized capabilities. This hybrid approach provides flexibility while taking advantage of the Converse API’s standardization benefits.</p>
<hr>
<h3 id="solution-overview"><strong>Solution overview</strong></h3>
<p>The wrapper API framework provides a unified interface between Poe and Amazon Bedrock models. It serves as a translation layer that normalizes the differences between models and protocols while maintaining the unique capabilities of each model.</p>
<p>The solution architecture follows a modular design that separates concerns and enables flexible scaling, as illustrated in the following diagram.</p>
<p><img src="../../3-blogstranslated/3.1-blog1/3.png" alt=""></p>
<p><em>Figure 3: High-level architecture of the wrapper API framework between Poe and Amazon Bedrock</em></p>
<p>The wrapper API consists of several key components working together to provide a seamless integration experience:</p>
<ul>
<li>
<h4 id="client"><strong>Client</strong></h4>
<p>The entry point where users interact with AI capabilities through various interfaces (web browser, mobile app, APIs, and so on).</p>
</li>
<li>
<h4 id="poe-layer-which-includes"><strong>Poe layer</strong>, which includes:</h4>
<ul>
<li><strong>Poe UI</strong> – Handles user experience, including request formation, parameter controls, file uploads, and response visualization.</li>
<li><strong>Poe FastAPI</strong> – Standardizes user interactions and manages the communication protocol between clients and underlying systems. This acts as a protocol management layer, ensuring consistency in how data and responses are transmitted.</li>
</ul>
</li>
<li>
<h4 id="bot-factory"><strong>Bot Factory</strong></h4>
<p>A <em>factory pattern</em> mechanism that dynamically creates appropriate model handlers (bots) based on the requested model type—for example, chat models, image generation models, or video generation models.</p>
<p>This structure makes it easy to extend the system to support new model types or variants of existing models in the future. The following code snippet illustrates how the Bot Factory selects the appropriate model handler based on the configuration:</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From core/bot_factory.py - Actual implementation</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BotFactory</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Factory for creating different types of bots.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Handles bot creation based on the bot type and configuration.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_bot</span>(bot_config: BotConfig) <span style="color:#f92672">-&gt;</span> PoeBot:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check if a custom bot class is specified</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> hasattr(bot_config, <span style="color:#e6db74">&#39;bot_class&#39;</span>) <span style="color:#f92672">and</span> bot_config<span style="color:#f92672">.</span>bot_class:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Use the custom bot class directly</span>
</span></span><span style="display:flex;"><span>            bot <span style="color:#f92672">=</span> bot_config<span style="color:#f92672">.</span>bot_class(bot_config)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Explicitly ensure we&#39;re returning a PoeBot</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> isinstance(bot, PoeBot):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">TypeError</span>(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Custom bot class must return a PoeBot instance, got </span><span style="color:#e6db74">{</span>type(bot)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> bot
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Determine bot type based on configuration</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> hasattr(bot_config, <span style="color:#e6db74">&#39;enable_video_generation&#39;</span>) <span style="color:#f92672">and</span> bot_config<span style="color:#f92672">.</span>enable_video_generation:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Video generation bot</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;luma&#39;</span> <span style="color:#f92672">in</span> bot_config<span style="color:#f92672">.</span>bot_name:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">from</span> core.refactored_luma_bot <span style="color:#f92672">import</span> LumaVideoBot
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> LumaVideoBot(bot_config)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">from</span> core.refactored_nova_reel_bot <span style="color:#f92672">import</span> NovaReelVideoBot
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> NovaReelVideoBot(bot_config)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> hasattr(bot_config, <span style="color:#e6db74">&#39;enable_image_generation&#39;</span>) <span style="color:#f92672">and</span> bot_config<span style="color:#f92672">.</span>enable_image_generation:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Image generation bot</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> hasattr(bot_config, <span style="color:#e6db74">&#39;model_id&#39;</span>) <span style="color:#f92672">and</span> <span style="color:#e6db74">&#34;stability&#34;</span> <span style="color:#f92672">in</span> bot_config<span style="color:#f92672">.</span>model_id<span style="color:#f92672">.</span>lower():
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Stability AI image generation bot</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">from</span> core.refactored_image_stability_ai <span style="color:#f92672">import</span> AmazonBedrockImageStabilityAIBot
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> AmazonBedrockImageStabilityAIBot(bot_config)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Other image generation bot (Titan, Canvas, etc.)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">from</span> core.refactored_image_bot_amazon <span style="color:#f92672">import</span> RefactoredAmazonImageGenerationBot
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> RefactoredAmazonImageGenerationBot(bot_config)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Check if this is a Claude 3.7 model</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> hasattr(bot_config, <span style="color:#e6db74">&#39;model_id&#39;</span>) <span style="color:#f92672">and</span> <span style="color:#e6db74">&#34;claude-3-7&#34;</span> <span style="color:#f92672">in</span> bot_config<span style="color:#f92672">.</span>model_id<span style="color:#f92672">.</span>lower():
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> ClaudePlusBot(bot_config)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Default to standard chat bot</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> RefactoredAmazonBedrockPoeBot(bot_config)
</span></span></code></pre></div><ul>
<li>
<h4 id="service-manager"><strong>Service manager</strong></h4>
<p>Orchestrates the services needed to process requests effectively. It coordinates multiple specialized services, including:</p>
<ul>
<li><strong>Token services</strong> – Managing token limits and counting.</li>
<li><strong>Streaming services</strong> – Handling real-time, streaming responses.</li>
<li><strong>Error services</strong> – Normalizing and handling errors consistently.</li>
<li><strong>AWS service integration</strong> – Managing API calls to Amazon Bedrock.</li>
</ul>
</li>
<li>
<h4 id="aws-services-component"><strong>AWS services component</strong></h4>
<p>Converts responses from Amazon Bedrock format to Poe’s expected format and vice versa, handling streaming chunks, image data, and video outputs.</p>
</li>
<li>
<h4 id="amazon-bedrock-layer"><strong>Amazon Bedrock layer</strong></h4>
<p>Amazon’s foundation model (FM) service that provides the actual AI processing capabilities and model hosting, including:</p>
<ul>
<li><strong>Model diversity</strong> – Access to over 30 text models (such as Amazon Titan, Amazon Nova, Anthropic’s Claude, Meta’s Llama, Mistral, and others), as well as image and video models.</li>
<li><strong>API structure</strong> – Exposure of both model-specific APIs and the unified Converse API.</li>
<li><strong>Authentication</strong> – AWS SigV4 signing for secure access to model endpoints.</li>
<li><strong>Response management</strong> – Model outputs returned with standardized metadata and usage statistics.</li>
</ul>
</li>
</ul>
<p>The <strong>request processing flow</strong> in this unified wrapper API illustrates the orchestration required when bridging Poe’s event-driven ServerSentEvents protocol with Amazon Bedrock REST-based APIs, showing how multiple specialized services collaborate to deliver a seamless user experience.</p>
<p>The flow begins when a client sends a request through Poe’s interface, which then forwards it to the Bot Factory component. This <em>factory pattern</em> dynamically creates the appropriate model handler based on the requested model type—chat, image, or video generation. The Service Manager then orchestrates the various specialized services required to process the request effectively, including token management, streaming, and error handling.</p>
<p>The sequence diagram below illustrates the complete request processing flow:</p>
<p><img src="../../3-blogstranslated/3.1-blog1/4.png" alt=""></p>
<hr>
<h3 id="configuration-template-for-rapid-multi-bot-deployment"><strong>Configuration template for rapid multi-bot deployment</strong></h3>
<p>The most powerful aspect of the wrapper API is its unified configuration template system, which supports rapid deployment and management of multiple bots with minimal code changes. This approach is central to the solution’s success in reducing deployment time.</p>
<p>The system uses a <strong>template-based configuration approach</strong>, combining shared defaults with model-specific overrides:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Bot configurations using the template pattern</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CHAT_BOTS <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;poe-nova-micro&#39;</span>: BotConfig(
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Identity</span>
</span></span><span style="display:flex;"><span>        bot_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;poe-nova-micro&#39;</span>,
</span></span><span style="display:flex;"><span>        model_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;amazon.nova-micro-v1:0&#39;</span>,
</span></span><span style="display:flex;"><span>        aws_region<span style="color:#f92672">=</span>aws_config[<span style="color:#e6db74">&#39;region&#39;</span>],
</span></span><span style="display:flex;"><span>        poe_access_key<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;XXXXXXXXXXXXXXXXXXXXXX&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Model-specific parameters</span>
</span></span><span style="display:flex;"><span>        supports_system_messages<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        enable_image_comprehension<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        expand_text_attachments<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        streaming<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        max_tokens<span style="color:#f92672">=</span><span style="color:#ae81ff">1300</span>,
</span></span><span style="display:flex;"><span>        temperature<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>,
</span></span><span style="display:flex;"><span>        top_p<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Model-specific pricing</span>
</span></span><span style="display:flex;"><span>        enable_monetization<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>        pricing_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;variable&#34;</span>,
</span></span><span style="display:flex;"><span>        input_token_cost_milli_cents<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>        output_token_cost_milli_cents<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>        image_analysis_cost_milli_cents<span style="color:#f92672">=</span><span style="color:#ae81ff">25</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Generate rate card with model-specific values</span>
</span></span><span style="display:flex;"><span>        custom_rate_card<span style="color:#f92672">=</span>create_rate_card(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">25</span>),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Include common parameters</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">**</span>DEFAULT_CHAT_CONFIG
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;poe-mistral-pixtral&#39;</span>: BotConfig(
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Identity</span>
</span></span><span style="display:flex;"><span>        bot_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;poe-mistral-pixtral&#39;</span>,
</span></span><span style="display:flex;"><span>        model_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;us.mistral.pixtral-large-2502-v1:0&#39;</span>,
</span></span><span style="display:flex;"><span>        aws_region<span style="color:#f92672">=</span>aws_config[<span style="color:#e6db74">&#39;region&#39;</span>],
</span></span><span style="display:flex;"><span>        poe_access_key<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;XXXXXXXXXXXXXXXXXXXXXX&#39;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Model-specific parameters</span>
</span></span><span style="display:flex;"><span>        supports_system_messages<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        enable_image_comprehension<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Include common parameters</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">**</span>DEFAULT_CHAT_CONFIG
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This configuration-driven architecture offers several significant advantages:</p>
<ul>
<li><strong>Rapid deployment</strong> – Adding new models requires only creating a new configuration entry rather than writing integration code. This is a key factor in the significant improvement in deployment time.</li>
<li><strong>Consistent parameter management</strong> – Common parameters are defined once in <code>DEFAULT_CHAT_CONFIG</code> and inherited by bots, maintaining consistency and reducing configuration duplication.</li>
<li><strong>Model-specific customization</strong> – Each model can have its own unique settings while still benefiting from the shared infrastructure.</li>
<li><strong>Operational flexibility</strong> – Parameters can be adjusted without code changes, allowing for quick experimentation and optimization.</li>
<li><strong>Centralized credential management</strong> – AWS credentials are managed in one place, improving security and simplifying updates.</li>
<li><strong>Region-specific deployment</strong> – Models can be deployed to different AWS Regions as needed, with Region settings controlled at the configuration level.</li>
</ul>
<p>The <code>BotConfig</code> class provides a structured way to define bot configurations with type validation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From config/bot_config.py - Actual implementation (partial)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BotConfig</span>(BaseModel):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Core Bot Identity</span>
</span></span><span style="display:flex;"><span>    bot_name: str <span style="color:#f92672">=</span> Field(<span style="color:#f92672">...</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Name of the bot&#34;</span>)
</span></span><span style="display:flex;"><span>    model_id: str <span style="color:#f92672">=</span> Field(<span style="color:#f92672">...</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Identifier for the AI model&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># AWS Configuration</span>
</span></span><span style="display:flex;"><span>    aws_region: Optional[str] <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;us-east-1&#34;</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;AWS region for deployment&#34;</span>)
</span></span><span style="display:flex;"><span>    aws_access_key: Optional[str] <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;AWS access key&#34;</span>)
</span></span><span style="display:flex;"><span>    aws_secret_key: Optional[str] <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;AWS secret key&#34;</span>)
</span></span><span style="display:flex;"><span>    aws_security_token: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Poe Configuration</span>
</span></span><span style="display:flex;"><span>    poe_access_key: str <span style="color:#f92672">=</span> Field(<span style="color:#f92672">...</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Poe access key&#34;</span>)
</span></span><span style="display:flex;"><span>    modal_app_name: str <span style="color:#f92672">=</span> Field(<span style="color:#f92672">...</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Modal app name&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Capability Flags</span>
</span></span><span style="display:flex;"><span>    allow_attachments: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Whether to allow file attachments in Poe&#34;</span>)
</span></span><span style="display:flex;"><span>    supports_system_messages: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    enable_image_comprehension: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    expand_text_attachments: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    streaming: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    enable_image_generation: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    enable_video_generation: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Inference Configuration</span>
</span></span><span style="display:flex;"><span>    max_tokens: Optional[int] <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Maximum number of tokens to generate&#34;</span>)
</span></span><span style="display:flex;"><span>    temperature: Optional[float] <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Temperature for sampling&#34;</span>)
</span></span><span style="display:flex;"><span>    top_p: Optional[float] <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Top-p sampling parameter&#34;</span>)
</span></span><span style="display:flex;"><span>    optimize_latency: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Enable latency optimization with performanceConfig&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Reasoning Configuration (Claude 3.7+)</span>
</span></span><span style="display:flex;"><span>    enable_reasoning: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Enable Claude&#39;s reasoning capability&#34;</span>)
</span></span><span style="display:flex;"><span>    reasoning_budget: Optional[int] <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Token budget for reasoning (1024-4000 recommended)&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Monetization Configuration</span>
</span></span><span style="display:flex;"><span>    enable_monetization: bool <span style="color:#f92672">=</span> Field(default<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Enable variable pricing monetization&#34;</span>)
</span></span><span style="display:flex;"><span>    custom_rate_card: Optional[str] <span style="color:#f92672">=</span> Field(
</span></span><span style="display:flex;"><span>        default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Custom rate card for variable pricing in markdown format&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    input_token_cost_milli_cents: Optional[int] <span style="color:#f92672">=</span> Field(
</span></span><span style="display:flex;"><span>        default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Cost per input token in thousandths of a cent&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    output_token_cost_milli_cents: Optional[int] <span style="color:#f92672">=</span> Field(
</span></span><span style="display:flex;"><span>        default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Cost per output token in thousandths of a cent&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    image_analysis_cost_milli_cents: Optional[int] <span style="color:#f92672">=</span> Field(
</span></span><span style="display:flex;"><span>        default<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>        description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Cost per image analysis in thousandths of a cent&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><hr>
<h3 id="advanced-multimodal-capabilities"><strong>Advanced multimodal capabilities</strong></h3>
<p>One of the most powerful aspects of the framework is how it handles multimodal capabilities through simple configuration flags:</p>
<ul>
<li><strong><code>enable_image_comprehension</code></strong> – When set to <code>True</code> for text-only models like Amazon Nova Micro, Poe itself uses vision capabilities to analyze images and convert them into text descriptions that are sent to the Amazon Bedrock model. This enables even text-only models to classify images without having built-in vision capabilities.</li>
<li><strong><code>expand_text_attachments</code></strong> – When set to <code>True</code>, Poe parses uploaded text files and includes their content in the conversation, enabling models to work with document content without requiring special file handling capabilities.</li>
<li><strong><code>supports_system_messages</code></strong> – This parameter controls whether the model can accept system prompts, allowing for consistent behavior across models with different capabilities.</li>
</ul>
<p>These configuration flags create a powerful abstraction layer that offers the following benefits:</p>
<ul>
<li><strong>Extends model capabilities</strong> – Text-only models gain <em>pseudo-multimodal</em> capabilities through Poe’s preprocessing.</li>
<li><strong>Optimizes built-in features</strong> – True multimodal models can use their built-in capabilities for optimal results.</li>
<li><strong>Simplifies integration</strong> – Toggling capabilities is done via configuration switches instead of code changes.</li>
<li><strong>Maintains consistency</strong> – Provides a uniform user experience regardless of the underlying model’s native capabilities.</li>
</ul>
<p>Next, we explore the technical implementation of the solution in more detail.</p>
<hr>
<h3 id="protocol-translation-layer"><strong>Protocol translation layer</strong></h3>
<p>The most technically challenging aspect of the solution was bridging between Poe’s API protocols and the diverse model interfaces available through Amazon Bedrock. The team accomplished this through a sophisticated protocol translation layer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From services/streaming_service.py - Actual implementation</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_extract_content_from_event</span>(self, event: Dict[str, Any]) <span style="color:#f92672">-&gt;</span> Optional[str]:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Extract content from a streaming event based on model provider.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Handle Anthropic Claude models</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;message&#34;</span> <span style="color:#f92672">in</span> event:
</span></span><span style="display:flex;"><span>            message <span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;message&#34;</span>, {})
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;content&#34;</span> <span style="color:#f92672">in</span> message <span style="color:#f92672">and</span> isinstance(message[<span style="color:#e6db74">&#34;content&#34;</span>], list):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> content_item <span style="color:#f92672">in</span> message[<span style="color:#e6db74">&#34;content&#34;</span>]:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> content_item<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;type&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;text&#34;</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> content_item<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;content&#34;</span> <span style="color:#f92672">in</span> message:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> str(message<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;content&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Handle Amazon Titan models</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;delta&#34;</span> <span style="color:#f92672">in</span> event:
</span></span><span style="display:flex;"><span>            delta <span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;delta&#34;</span>, {})
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#f92672">in</span> delta:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> delta<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Handle other model formats</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;chunk&#34;</span> <span style="color:#f92672">in</span> event:
</span></span><span style="display:flex;"><span>            chunk_data <span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;chunk&#34;</span>, {})
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;bytes&#34;</span> <span style="color:#f92672">in</span> chunk_data:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Process binary data if present</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                    text <span style="color:#f92672">=</span> chunk_data[<span style="color:#e6db74">&#34;bytes&#34;</span>]<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(text)<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;completion&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span>:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#34;Failed to decode bytes in chunk&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># No matching format found</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span></code></pre></div><p>This translation layer handles subtle differences between models and makes sure that regardless of which Amazon Bedrock model is being used, the response back to Poe is consistent and follows Poe’s expected format.</p>
<hr>
<h3 id="error-handling-and-normalization"><strong>Error handling and normalization</strong></h3>
<p>A critical aspect of the implementation is comprehensive error handling and normalization. The <code>ErrorService</code> provides consistent error handling across different models:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Simplified example of error handling (not actual code)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ErrorService</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">normalize_Amazon_Bedrock_error</span>(self, error: <span style="color:#a6e22e">Exception</span>) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Normalize Amazon Bedrock errors into a consistent format.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> isinstance(error, ClientError):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;ThrottlingException&#34;</span> <span style="color:#f92672">in</span> str(error):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;The model is currently experiencing high demand. Please try again in a moment.&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;ValidationException&#34;</span> <span style="color:#f92672">in</span> str(error):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;There was an issue with the request parameters. Please try again with different settings.&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;AccessDeniedException&#34;</span> <span style="color:#f92672">in</span> str(error):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Access to this model is restricted. Please check your permissions.&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;An error occurred while communicating with the model: </span><span style="color:#e6db74">{</span>str(error)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> isinstance(error, <span style="color:#a6e22e">ConnectionError</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Connection error. Please check your network and try again.&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;An unexpected error occurred: </span><span style="color:#e6db74">{</span>str(error)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><p>This approach ensures that users receive meaningful error messages regardless of the underlying model or error condition.</p>
<hr>
<h3 id="token-counting-and-optimization"><strong>Token counting and optimization</strong></h3>
<p>The system implements sophisticated token counting and optimization to maximize effective use of models:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From services/streaming_service.py - Actual implementation (partial)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate approximate JSON overhead</span>
</span></span><span style="display:flex;"><span>user_message_tokens <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> msg <span style="color:#f92672">in</span> conversation[<span style="color:#e6db74">&#39;messages&#39;</span>]:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> content_block <span style="color:#f92672">in</span> msg<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;content&#39;</span>, []):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;text&#39;</span> <span style="color:#f92672">in</span> content_block:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Simple word-based estimation of actual text content</span>
</span></span><span style="display:flex;"><span>            user_message_tokens <span style="color:#f92672">+=</span> len(content_block[<span style="color:#e6db74">&#39;text&#39;</span>]<span style="color:#f92672">.</span>split())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Estimate JSON structure overhead (difference between total and content)</span>
</span></span><span style="display:flex;"><span>json_overhead <span style="color:#f92672">=</span> int((input_tokens <span style="color:#f92672">-</span> system_tokens) <span style="color:#f92672">-</span> user_message_tokens)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Ensure we&#39;re working with integers for calculations</span>
</span></span><span style="display:flex;"><span>input_tokens_for_pct <span style="color:#f92672">=</span> int(input_tokens)
</span></span><span style="display:flex;"><span>system_tokens_for_pct <span style="color:#f92672">=</span> int(system_tokens)
</span></span><span style="display:flex;"><span>json_overhead_for_pct <span style="color:#f92672">=</span> int(json_overhead)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate percentage with float arithmetic and proper integer division</span>
</span></span><span style="display:flex;"><span>json_overhead_percent <span style="color:#f92672">=</span> (float(json_overhead_for_pct) <span style="color:#f92672">/</span> max(<span style="color:#ae81ff">1</span>, input_tokens_for_pct <span style="color:#f92672">-</span> system_tokens_for_pct)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span></code></pre></div><p>This detailed token tracking enables accurate cost estimation and optimization, facilitating efficient use of model resources.</p>
<hr>
<h3 id="aws-authentication-and-security"><strong>AWS authentication and security</strong></h3>
<p>The <code>AwsClientService</code> handles authentication and security for Amazon Bedrock API calls. This implementation provides secure authentication with AWS services while providing proper error handling and connection management.</p>
<hr>
<h3 id="comparative-analysis"><strong>Comparative analysis</strong></h3>
<p>The implementation of the wrapper API dramatically improved the efficiency and capabilities of deploying Amazon Bedrock models on Poe, as summarized below.</p>
<table>
  <thead>
      <tr>
          <th>Feature</th>
          <th>Before (Direct API)</th>
          <th>After (Wrapper API)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Deployment Time</strong></td>
          <td>Days per model</td>
          <td>Minutes per model</td>
      </tr>
      <tr>
          <td><strong>Developer Focus</strong></td>
          <td>Configuration and plumbing</td>
          <td>Innovation and features</td>
      </tr>
      <tr>
          <td><strong>Model Diversity</strong></td>
          <td>Limited by integration capacity</td>
          <td>Extensive (across Amazon Bedrock models)</td>
      </tr>
      <tr>
          <td><strong>Maintenance Overhead</strong></td>
          <td>High (separate code for each model)</td>
          <td>Low (configuration-based)</td>
      </tr>
      <tr>
          <td><strong>Error Handling</strong></td>
          <td>Custom per model</td>
          <td>Standardized across models</td>
      </tr>
      <tr>
          <td><strong>Cost Tracking</strong></td>
          <td>Complex (multiple integrations)</td>
          <td>Simplified (centralized)</td>
      </tr>
      <tr>
          <td><strong>Multimodal Support</strong></td>
          <td>Fragmented</td>
          <td>Unified</td>
      </tr>
      <tr>
          <td><strong>Security</strong></td>
          <td>Varied implementations</td>
          <td>Consistent best practices</td>
      </tr>
  </tbody>
</table>
<p>This comparison highlights the significant improvements achieved through the wrapper API approach, demonstrating the value of investing in a robust abstraction layer.</p>
<hr>
<h3 id="performance-metrics-and-business-impact"><strong>Performance metrics and business impact</strong></h3>
<p>The wrapper API framework delivered significant and measurable business impact across multiple dimensions, including increased model diversity, deployment efficiency, and developer productivity.</p>
<p>Poe can rapidly expand its model offerings, integrating dozens of Amazon Bedrock models across text, image, and video modalities. This expansion occurred over a period of weeks rather than the months it would have taken with the previous approach.</p>
<p>The following table summarizes the <strong>deployment efficiency metrics</strong>:</p>
<table>
  <thead>
      <tr>
          <th>Metric</th>
          <th>Before</th>
          <th>After</th>
          <th>Improvement</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>New Model Deployment</strong></td>
          <td>2–3 days</td>
          <td>15 minutes</td>
          <td>96× faster</td>
      </tr>
      <tr>
          <td><strong>Code Changes Required</strong></td>
          <td>500+ lines</td>
          <td>20–30 lines</td>
          <td>95% reduction</td>
      </tr>
      <tr>
          <td><strong>Testing Time</strong></td>
          <td>8–12 hours</td>
          <td>30–60 minutes</td>
          <td>87% reduction</td>
      </tr>
      <tr>
          <td><strong>Deployment Steps</strong></td>
          <td>10–15 steps</td>
          <td>3–5 steps</td>
          <td>75% reduction</td>
      </tr>
  </tbody>
</table>
<p>These metrics were measured through direct comparison of engineering hours required before and after implementation, tracking actual deployments of new models.</p>
<p>The engineering team also observed a dramatic shift in focus from integration work to feature development, as shown in the table below:</p>
<table>
  <thead>
      <tr>
          <th>Activity</th>
          <th>Before (% of time)</th>
          <th>After (% of time)</th>
          <th>Change</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>API Integration</strong></td>
          <td>65%</td>
          <td>15%</td>
          <td>−50%</td>
      </tr>
      <tr>
          <td><strong>Feature Development</strong></td>
          <td>20%</td>
          <td>60%</td>
          <td>+40%</td>
      </tr>
      <tr>
          <td><strong>Testing</strong></td>
          <td>10%</td>
          <td>15%</td>
          <td>+5%</td>
      </tr>
      <tr>
          <td><strong>Documentation</strong></td>
          <td>5%</td>
          <td>10%</td>
          <td>+5%</td>
      </tr>
  </tbody>
</table>
<hr>
<h3 id="scaling-and-performance-considerations"><strong>Scaling and performance considerations</strong></h3>
<p>The wrapper API is designed to handle high-volume production workloads with robust scaling capabilities.</p>
<h4 id="connection-pooling"><strong>Connection pooling</strong></h4>
<p>To handle multiple concurrent requests efficiently, the wrapper implements connection pooling using <code>aiobotocore</code>. This allows it to maintain a pool of connections to Amazon Bedrock, reducing the overhead of establishing new connections for each request:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From services/aws_service.py - Connection management</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setup_client</span>(self) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Initialize AWS client with proper configuration.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>_client_lock:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Always clean up existing clients first to avoid stale connections</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>Amazon_Bedrock_client:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>cleanup()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Increase timeout for image generation</span>
</span></span><span style="display:flex;"><span>            config <span style="color:#f92672">=</span> Config(
</span></span><span style="display:flex;"><span>                read_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>,  <span style="color:#75715e"># 5 minutes timeout</span>
</span></span><span style="display:flex;"><span>                retries<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;max_attempts&#39;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;mode&#39;</span>: <span style="color:#e6db74">&#39;adaptive&#39;</span>},
</span></span><span style="display:flex;"><span>                connect_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>  <span style="color:#75715e"># 30 second connection timeout</span>
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Create the Amazon Bedrock client with proper error handling</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Amazon_Bedrock_client <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>create_client(
</span></span><span style="display:flex;"><span>                service_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Amazon_Bedrock-runtime&#34;</span>,
</span></span><span style="display:flex;"><span>                region_name<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bot_config<span style="color:#f92672">.</span>aws_region,
</span></span><span style="display:flex;"><span>                aws_access_key_id<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bot_config<span style="color:#f92672">.</span>aws_access_key,
</span></span><span style="display:flex;"><span>                aws_secret_access_key<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bot_config<span style="color:#f92672">.</span>aws_secret_key,
</span></span><span style="display:flex;"><span>                aws_session_token<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bot_config<span style="color:#f92672">.</span>aws_security_token,
</span></span><span style="display:flex;"><span>                config<span style="color:#f92672">=</span>config
</span></span><span style="display:flex;"><span>            )<span style="color:#f92672">.</span><span style="color:#a6e22e">__aenter__</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>Amazon_Bedrock_client <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span>
</span></span></code></pre></div><h4 id="asynchronous-processing"><strong>Asynchronous processing</strong></h4>
<p>The entire framework uses asynchronous processing to handle concurrent requests efficiently:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From core/refactored_chat_bot.py - Asynchronous request handling</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_response</span>(self, query: QueryRequest) <span style="color:#f92672">-&gt;</span> AsyncIterable[PartialResponse]:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Ensure AWS client is set up</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> aws_service<span style="color:#f92672">.</span>setup_client()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Validate and format the conversation</span>
</span></span><span style="display:flex;"><span>        conversation <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> conversation_service<span style="color:#f92672">.</span>validate_conversation(query)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Process the request with streaming</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>bot_config<span style="color:#f92672">.</span>streaming:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">for</span> chunk <span style="color:#f92672">in</span> streaming_service<span style="color:#f92672">.</span>stream_Amazon_Bedrock_response(conversation, request_id):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">yield</span> chunk
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Non-streaming mode</span>
</span></span><span style="display:flex;"><span>            response_text, input_tokens, output_tokens <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> streaming_service<span style="color:#f92672">.</span>non_stream_Amazon_Bedrock_response(conversation, request_id)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> response_text:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">yield</span> PartialResponse(text<span style="color:#f92672">=</span>response_text)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">yield</span> PartialResponse(text<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>bot_config<span style="color:#f92672">.</span>fallback_response)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Send done event for non-streaming mode</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">yield</span> self<span style="color:#f92672">.</span>done_event()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Error handling</span>
</span></span><span style="display:flex;"><span>        error_message <span style="color:#f92672">=</span> error_service<span style="color:#f92672">.</span>log_error(e, request_id, <span style="color:#e6db74">&#34;Error during request processing&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> PartialResponse(text<span style="color:#f92672">=</span>error_message)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> self<span style="color:#f92672">.</span>done_event()
</span></span></code></pre></div><h4 id="error-recovery-and-retry-logic"><strong>Error recovery and retry logic</strong></h4>
<p>The system implements sophisticated error recovery and retry logic to handle transient issues:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From services/streaming_service.py - Retry logic</span>
</span></span><span style="display:flex;"><span>max_retries <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>base_delay <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># Start with 1 second delay</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> attempt <span style="color:#f92672">in</span> range(max_retries):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>aws_service<span style="color:#f92672">.</span>Amazon_Bedrock_client:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">yield</span> PartialResponse(text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Error: Amazon Bedrock client is not initialized&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>aws_service<span style="color:#f92672">.</span>Amazon_Bedrock_client<span style="color:#f92672">.</span>converse_stream(<span style="color:#f92672">**</span>stream_config)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Process response...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>  <span style="color:#75715e"># Success, exit retry loop</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> ClientError <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;ThrottlingException&#34;</span> <span style="color:#f92672">in</span> str(e):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> attempt <span style="color:#f92672">&lt;</span> max_retries <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                delay <span style="color:#f92672">=</span> base_delay <span style="color:#f92672">*</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> attempt)  <span style="color:#75715e"># Exponential backoff</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(delay)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        error_message <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Amazon Bedrock API Error: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> PartialResponse(text<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error: </span><span style="color:#e6db74">{</span>error_message<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span></code></pre></div><h4 id="performance-metrics"><strong>Performance metrics</strong></h4>
<p>The system collects detailed performance metrics to help identify bottlenecks and optimize performance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From services/streaming_service.py - Performance metrics</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Log token usage and latency</span>
</span></span><span style="display:flex;"><span>latency <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>perf_counter() <span style="color:#f92672">-</span> start_time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>info(
</span></span><span style="display:flex;"><span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[</span><span style="color:#e6db74">{</span>request_id<span style="color:#e6db74">}</span><span style="color:#e6db74">] Streaming Response Metrics:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34; Time to First Token: </span><span style="color:#e6db74">{</span>first_token_time<span style="color:#e6db74">:</span><span style="color:#e6db74">.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> seconds</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34; Input Tokens: </span><span style="color:#e6db74">{</span>input_tokens<span style="color:#e6db74">}</span><span style="color:#e6db74"> (includes system prompt)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34; Input Tokens for Billing: </span><span style="color:#e6db74">{</span>input_tokens <span style="color:#f92672">-</span> system_tokens<span style="color:#e6db74">}</span><span style="color:#e6db74"> (excludes system prompt)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34; Output Tokens: </span><span style="color:#e6db74">{</span>output_tokens<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34; Total Tokens: </span><span style="color:#e6db74">{</span>total_tokens<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34; Amazon Bedrock Latency: </span><span style="color:#e6db74">{</span>latency<span style="color:#e6db74">:</span><span style="color:#e6db74">.4f</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> seconds</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34; Latency Optimization: </span><span style="color:#e6db74">{</span><span style="color:#e6db74">&#39;enabled&#39;</span> <span style="color:#66d9ef">if</span> hasattr(self<span style="color:#f92672">.</span>bot_config, <span style="color:#e6db74">&#39;optimize_latency&#39;</span>) <span style="color:#f92672">and</span> self<span style="color:#f92672">.</span>bot_config<span style="color:#f92672">.</span>optimize_latency <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;disabled&#39;</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><hr>
<h3 id="security-considerations"><strong>Security considerations</strong></h3>
<p>Security is a critical aspect of the wrapper implementation, with several key features to support secure operation.</p>
<h4 id="jwt-validation-with-aws-sigv4-signing"><strong>JWT validation with AWS SigV4 signing</strong></h4>
<p>The system integrates JWT validation for Poe’s authentication with AWS SigV4 signing for Amazon Bedrock API calls:</p>
<ul>
<li><strong>JWT validation</strong> – Ensures only authorized Poe requests can access the wrapper API.</li>
<li><strong>SigV4 signing</strong> – Ensures the wrapper API can securely authenticate with Amazon Bedrock.</li>
<li><strong>Credential management</strong> – AWS credentials are securely managed and not exposed to clients.</li>
</ul>
<h4 id="secrets-management"><strong>Secrets management</strong></h4>
<p>The system integrates with <a href="https://aws.amazon.com/secrets-manager/">AWS Secrets Manager</a> to securely store and retrieve sensitive credentials:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From services/aws_service.py - Secrets management</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_secret</span>(secret_name: str, region_name: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us-east-1&#34;</span>) <span style="color:#f92672">-&gt;</span> Dict[str, Any]:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Retrieve a secret from AWS Secrets Manager.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        secret_name: Name of the secret to retrieve
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        region_name: AWS region where the secret is stored
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Dict[str, Any]: The secret value as a dictionary
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Create a Secrets Manager client</span>
</span></span><span style="display:flex;"><span>    session <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>Session()
</span></span><span style="display:flex;"><span>    client <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>client(
</span></span><span style="display:flex;"><span>        service_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;secretsmanager&#39;</span>,
</span></span><span style="display:flex;"><span>        region_name<span style="color:#f92672">=</span>region_name
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        get_secret_value_response <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>get_secret_value(
</span></span><span style="display:flex;"><span>            SecretId<span style="color:#f92672">=</span>secret_name
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        logging<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error retrieving secret </span><span style="color:#e6db74">{</span>secret_name<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Depending on whether the secret is a string or binary, one of these fields will be populated.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;SecretString&#39;</span> <span style="color:#f92672">in</span> get_secret_value_response:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Explicitly annotate the return type for mypy</span>
</span></span><span style="display:flex;"><span>            result: Dict[str, Any] <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(get_secret_value_response[<span style="color:#e6db74">&#39;SecretString&#39;</span>])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> json<span style="color:#f92672">.</span>JSONDecodeError:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># If not a JSON, return as a single-key dictionary</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;SecretString&#34;</span>: get_secret_value_response[<span style="color:#e6db74">&#39;SecretString&#39;</span>]}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>        decoded_binary_secret <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(get_secret_value_response[<span style="color:#e6db74">&#39;SecretBinary&#39;</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#34;SecretBinary&#34;</span>: decoded_binary_secret}
</span></span></code></pre></div><h4 id="secure-connection-management"><strong>Secure connection management</strong></h4>
<p>The system implements secure connection management to help prevent credential leakage and ensure proper cleanup:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From services/aws_service.py - Secure connection cleanup</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cleanup</span>(self) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Clean up AWS client resources.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>Amazon_Bedrock_client:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>Amazon_Bedrock_client<span style="color:#f92672">.</span><span style="color:#a6e22e">__aexit__</span>(<span style="color:#66d9ef">None</span>, <span style="color:#66d9ef">None</span>, <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error closing Amazon Bedrock client: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>Amazon_Bedrock_client <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Successfully cleaned up AWS client resources&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Even if cleanup fails, reset the references to avoid stale connections</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>Amazon_Bedrock_client <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span></code></pre></div><hr>
<h3 id="troubleshooting-and-debugging"><strong>Troubleshooting and debugging</strong></h3>
<p>The wrapper API includes comprehensive logging and debugging capabilities to help identify and resolve issues. The system implements detailed logging throughout the request processing flow. Each request is assigned a unique ID that is used throughout the processing flow to enable tracing:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From core/refactored_chat_bot.py - Request tracing</span>
</span></span><span style="display:flex;"><span>request_id <span style="color:#f92672">=</span> str(id(query))
</span></span><span style="display:flex;"><span>start_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>perf_counter()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Used in all log messages</span>
</span></span><span style="display:flex;"><span>self<span style="color:#f92672">.</span>logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;[</span><span style="color:#e6db74">{</span>request_id<span style="color:#e6db74">}</span><span style="color:#e6db74">] Incoming request received&#34;</span>)
</span></span></code></pre></div><hr>
<h3 id="lessons-learned-and-best-practices"><strong>Lessons learned and best practices</strong></h3>
<p>Through this collaboration, several important technical insights emerged that may benefit others undertaking similar projects:</p>
<ul>
<li><strong>Configuration-driven architecture</strong> – Using configuration files rather than hard-coded model-specific behaviors proved enormously beneficial for maintenance and extensibility. This approach allowed new models to be added without code changes, significantly reducing the risk of introducing bugs.</li>
<li><strong>Protocol translation challenges</strong> – The most complex aspect was handling the subtle differences in streaming protocols between different models. Building a robust abstraction required careful consideration of edge cases and comprehensive error handling.</li>
<li><strong>Error normalization</strong> – Creating a consistent error experience across diverse models required sophisticated error handling that could translate model-specific errors into user-friendly, actionable messages. This improved both developer and end-user experiences.</li>
<li><strong>Type safety</strong> – Strong typing (using Python’s type hints extensively) was crucial for maintaining code quality across a complex codebase with multiple contributors. This practice reduced bugs and improved code maintainability.</li>
<li><strong>Security first</strong> – Integrating Secrets Manager from the start ensured credentials were handled securely throughout the system’s lifecycle, helping prevent potential security vulnerabilities.</li>
</ul>
<hr>
<h3 id="conclusion"><strong>Conclusion</strong></h3>
<p>The collaboration between the AWS Generative AI Innovation Center and Quora demonstrates how thoughtful architectural design can dramatically accelerate AI deployment and innovation. By creating a unified wrapper API for Amazon Bedrock models, the teams were able to reduce deployment time from days to minutes while expanding model diversity and improving user experience.</p>
<p>This approach—focusing on abstraction, configuration-driven development, and robust error handling—offers valuable lessons for organizations looking to integrate multiple AI models efficiently. The patterns and techniques demonstrated in this solution can be applied to similar challenges across a wide range of AI integration scenarios.</p>
<p>For technology leaders and developers working on similar challenges, this case study highlights the value of investing in flexible integration frameworks rather than point-to-point integrations. The initial investment in building a robust abstraction layer pays dividends in long-term maintenance and capability expansion.</p>
<hr>
<h3 id="to-learn-more-about-implementing-similar-solutions-explore"><strong>To learn more about implementing similar solutions, explore:</strong></h3>
<ul>
<li><a href="https://aws.amazon.com/architecture/well-architected/">AWS Well-Architected Framework</a> – Best practices for building secure, high-performing, resilient, and efficient infrastructure.</li>
<li><a href="https://docs.aws.amazon.com/bedrock/latest/userguide/what-is-bedrock.html">Amazon Bedrock Developer Guide</a> – Detailed information on working with foundation models (FMs).</li>
<li><a href="https://aws.amazon.com/generative-ai/innovation-center/">AWS Generative AI Innovation Center</a> – Support for innovative generative AI projects.</li>
<li><a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/patterns/deploy-llms-on-aws.html">AWS Prescriptive Guidance for LLM Deployment</a> – Best practices for deploying large language models (LLMs).</li>
</ul>
<p>The AWS Generative AI Innovation Center and Quora teams continue to collaborate on enhancements to this framework, ensuring Poe users have access to the latest and most capable AI models with minimal deployment delay.</p>
<hr>
<h3 id="about-the-authors"><strong>About the authors</strong></h3>
<table>
  <thead>
      <tr>
          <th style="text-align: left"><img src="../../3-blogstranslated/3.1-blog1/5.png" alt=""></th>
          <th style="text-align: left"><strong>Dr. Gilbert V. Lepadatu</strong> is a Senior Deep Learning Architect at the AWS Generative AI Innovation Center, where he helps enterprise customers design and deploy scalable, cutting-edge GenAI solutions. With a PhD in Philosophy and dual Master’s degrees, he brings a holistic and interdisciplinary approach to data science and AI.</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><img src="../../3-blogstranslated/3.1-blog1/6.jpeg" alt=""></td>
          <td style="text-align: left"><strong>Nick Huber</strong> is the AI Ecosystem Lead for Poe (by Quora), where he is responsible for ensuring high-quality and timely integrations of leading AI models onto the Poe platform.</td>
      </tr>
  </tbody>
</table>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../3-blogstranslated/" title="Translated Blogs"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../3-blogstranslated/3.2-blog2/" title="Streamline access to ISO-rating content changes with Verisk Rating Insights and Amazon Bedrock" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1765232845"></script>
    <script src="../../js/perfect-scrollbar.min.js?1765232845"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1765232845"></script>
    <script src="../../js/jquery.sticky.js?1765232845"></script>
    <script src="../../js/featherlight.min.js?1765232845"></script>
    <script src="../../js/highlight.pack.js?1765232845"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js?1765232845"></script>
    <script src="../../js/learn.js?1765232845"></script>
    <script src="../../js/hugo-learn.js?1765232845"></script>

    <link href="../../mermaid/mermaid.css?1765232845" rel="stylesheet" />
    <script src="../../mermaid/mermaid.js?1765232845"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function (i, s, o, g, r, a, m) {
    i["GoogleAnalyticsObject"] = r;
    ((i[r] =
      i[r] ||
      function () {
        (i[r].q = i[r].q || []).push(arguments);
      }),
      (i[r].l = 1 * new Date()));
    ((a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]));
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m);
  })(
    window,
    document,
    "script",
    "https://www.google-analytics.com/analytics.js",
    "ga",
  );

  ga("create", "UA-158079754-2", "auto");
  ga("send", "pageview");
</script>

  </body>
</html>
